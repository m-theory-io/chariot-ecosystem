<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chariot Orchestrator</title>
  <style>
    :root {
      --bg: #151a20; --panel: #1f2630; --accent: #2b7fff; --text: #e6eef8; --muted: #8aa2c0;
    }
    html, body { height: 100%; margin: 0; }
    body { background: var(--bg); color: var(--text); font: 14px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; }
    .toolbar {
      display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: var(--panel); border-bottom: 1px solid #2d3947; position: sticky; top: 0; z-index: 10;
    }
    .toolbar h1 { font-size: 16px; margin: 0 14px 0 0; color: var(--muted); font-weight: 600; }
    .tabs { display: flex; gap: 6px; }
    .tab {
      appearance: none; border: 1px solid #324252; background: #222b36; color: var(--text);
      padding: 6px 10px; border-radius: 6px; cursor: pointer;
    }
    .tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .spacer { flex: 1; }
    .btn {
      appearance: none; border: 1px solid #324252; background: #1a212a; color: var(--text);
      padding: 6px 10px; border-radius: 6px; cursor: pointer;
    }
    .btn:hover { border-color: #3b4e64; }
    .frame {
      position: fixed; inset: 52px 0 0 0; border: 0; width: 100%; height: calc(100% - 52px); background: #0f141a;
    }
    .status { color: var(--muted); font-size: 12px; }
    a.btn { text-decoration: none; display: inline-block; }
  </style>
</head>
<body>
  <div class="toolbar">
    <h1>Chariot</h1>
    <div class="tabs">
      <button class="tab" data-app="visual-dsl" title="Visual DSL">üìä Visual DSL</button>
      <button class="tab" data-app="charioteer" title="Charioteer">‚öôÔ∏è Charioteer</button>
    </div>
    <div class="spacer"></div>
    <span class="status" id="status"></span>
    <a id="openNewTab" class="btn" href="#" target="_blank" rel="noopener">Open in new tab</a>
  </div>

  <iframe id="microframe" class="frame" src="about:blank" allow="clipboard-read; clipboard-write"></iframe>

  <script>
    (function () {
      const ROUTES = {
        "visual-dsl": "/visual-dsl/",
        "charioteer": "/charioteer/editor"
      };
      const tabs = Array.from(document.querySelectorAll(".tab"));
      const frame = document.getElementById("microframe");
      const statusEl = document.getElementById("status");
      const link = document.getElementById("openNewTab");
      const LS_KEY = "chariot.orchestrator.app";

      function setActive(app) {
        tabs.forEach(t => t.classList.toggle("active", t.dataset.app === app));
        const url = ROUTES[app] || ROUTES["visual-dsl"];
        frame.src = url;
        link.href = url;
        statusEl.textContent = app === "visual-dsl" ? "Visual DSL" : "Charioteer";
        localStorage.setItem(LS_KEY, app);
        // reflect in hash for deep links
        if (location.hash !== "#" + app) history.replaceState(null, "", "#" + app);
      }

      tabs.forEach(t => t.addEventListener("click", () => setActive(t.dataset.app)));

      // pick app from hash, then localStorage, else default
      const fromHash = location.hash.replace(/^#/, "");
      const initial = ROUTES[fromHash] ? fromHash : (localStorage.getItem(LS_KEY) || "visual-dsl");
      setActive(initial);

      // allow external hash switch (#visual-dsl / #charioteer)
      window.addEventListener("hashchange", () => {
        const h = location.hash.replace(/^#/, "");
        if (ROUTES[h]) setActive(h);
      });
    })();
  </script>
</body>
</html>
